{"version":3,"file":"model.esm.js","sources":["../src/meta.js","../src/mixin.js","../src/mixins/attributable.js","../src/mixins/relatable.js","../src/mixins/translatable.js","../src/validators/datetime.js","../src/validators/presence.js","../src/mixins/validatable.js","../src/model.js","../src/mixins/decorator.js","../src/config/i18n/translations.js"],"sourcesContent":["// utility function for metaprogramming\n\nimport _ from '@caiena/lodash-ext'\n\n\nfunction defineInternalProp(obj, prop, value) {\n  Object.defineProperty(obj, prop, {\n    enumerable: false,\n    writable: true,\n    configurable: true,\n    value\n  })\n}\n\n\n// checks for property in instance or its prototype\nfunction writableProp(instance, name) {\n  // avoiding reserved props (e.g. constructor) or names starting with $ - model.js \"meta\" props\n  if (_.includes(['constructor'], name) || _.startsWith(name, '$')) return false\n\n  let descriptor = null\n\n  if (instance.hasOwnProperty(name)) {\n    descriptor = Object.getOwnPropertyDescriptor(instance, name)\n  } else {\n    // falling back to prototype\n    let prototype = Object.getPrototypeOf(instance)\n    descriptor = Object.getOwnPropertyDescriptor(prototype, name)\n  }\n\n  // XXX: we're considering \"writableProp\" a prop that is defined as get/set and\n  // has a setter method!\n  return !!descriptor.set\n}\n\n\n// checks for property in instance or its prototype\nfunction writablePropNames(instance) {\n  let prototype = Object.getPrototypeOf(instance)\n  let propNames = _.chain(Object.getOwnPropertyNames(instance))\n    .concat(Object.getOwnPropertyNames(prototype))\n    .uniq()\n    .value()\n    .sort()\n\n  return _.filter(propNames, (name) => writableProp(instance, name))\n}\n\n\n// can't export default and import named destructuring. So we're exporting named (non-default).\n// https://github.com/babel/babel-loader/issues/194\nexport {\n  defineInternalProp,\n  writableProp,\n  writablePropNames\n}\n","// @see https://github.com/Vincit/objection.js/blob/2f7dd232aec1b1b3d880d10e75b169af2554ea91/lib/utils/mixin.js\nimport _ from '@caiena/lodash-ext'\n\n\nfunction mixin(Class, mixins) {\n  return mixins.reduce((MixedClass, Mixin) => Mixin(MixedClass), Class)\n}\n\n\nexport default mixin\n","import _                      from '@caiena/lodash-ext'\nimport Enum                   from '@caiena/enum'\nimport mixin                  from '../mixin'\nimport { defineInternalProp, writablePropNames } from '../meta'\n\n\n\nfunction defineAttr(obj, attrName, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$attrs[attrName]\n    }\n  }\n\n  if (!set) {\n    set = function set(value) {\n      return this.$attrs[attrName] = value\n    }\n  }\n\n  Object.defineProperty(obj, attrName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\nfunction defineEnum(obj, enumName, { get = null, set = null } = {}) {\n  // custom setter for enums\n  if (!set) {\n    set = function set(value) {\n      // accepts null value\n      if (value === null) return this.$attrs[enumName] = null\n\n      // ensures setting the key as attr value\n      let key = this.constructor.$enums[enumName].key(value)\n      return this.$attrs[enumName] = key\n    }\n  }\n\n  defineAttr(obj, enumName, { get, set })\n}\n\n\n\nfunction Attributable(Class) {\n\n  class AttributableClass extends Class {\n\n    // lazy evaluated $enums, using @caiena/enum\n    static get $enums() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$enums')) {\n        this.$$enums = _.reduce(this.enums, (result, enumeration, enumName) => {\n          // transform to Enum instance, if needed\n          result[enumName] = (enumeration instanceof Enum) ? enumeration : new Enum(enumeration)\n\n          return result\n        }, {})\n      }\n\n      return this.$$enums\n    }\n\n    // lazy evaluated $attrs\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $attrs() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$attrs')) {\n        this.$$attrs = _.clone(this.attrs)\n      }\n\n      return this.$$attrs\n    }\n\n\n    // lazy evaluated $virtuals\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $virtuals() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$virtuals')) {\n        this.$$virtuals = _.clone(this.virtuals)\n      }\n\n      return this.$$virtuals\n    }\n\n\n    constructor(...args) {\n      super(...args)\n\n      let klass = this.constructor\n\n      defineInternalProp(this, '$$attrs', {})\n\n      // handling enums first then attrs, avoiding overrides\n      // defining enums get/set properties\n      _.each(klass.$enums, (enumeration, enumName) => {\n        // sanity check!\n        // enum must be defined in attrs list as well\n        if (!_.includes(klass.$attrs, enumName)) {\n          throw new Error(`enum \"${enumName}\" is not listed as an attribute in model ${klass.name}`)\n        }\n\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(enumName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(enumName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, enumName)\n            defineEnum(this, enumName, { get: _descr.get, set: _descr.set })\n          } else {\n            defineEnum(this, enumName)\n          }\n        }\n      })\n\n      // defining attrs get/set properties\n      _.each(klass.$attrs, (attrName) => {\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(attrName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(attrName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, attrName)\n            defineAttr(this, attrName, { get: _descr.get, set: _descr.set })\n          } else {\n            defineAttr(this, attrName)\n          }\n        }\n      })\n    }\n\n    get $attrs() {\n      // XXX: $attrs and $$attrs will be confusing...\n      return this.$$attrs\n    }\n\n    set $attrs(attrs) {\n      // TODO: remove old code\n      // return _.merge(this.$$attrs, attrs)\n\n      // set props, one-by-one, using setter method\n      let sanitizedAttrs = _.pick(attrs, this.constructor.$attrs)\n      _.each(sanitizedAttrs, (value, name) => {\n        this[name] = value\n      })\n    }\n\n    // TODO: remove it?\n    get $props() {\n      let instance = this\n      let proto = Object.getPrototypeOf(this)\n      let propNames = _.chain(Object.getOwnPropertyNames(proto))\n        .concat(Object.getOwnPropertyNames(instance))\n        .filter((name) => !(_.includes(['constructor'], name) || _.startsWith(name, '$')))\n        .uniq()\n        .value()\n        .sort()\n\n      return _.reduce(propNames, (props, propName) => {\n        props[propName] = this[propName]\n        return props\n      }, {})\n    }\n\n    $blank(attrNameOrPath) {\n      return _.blank(this.$get(attrNameOrPath))\n    }\n\n    $enumValue(enumName) {\n      return this.constructor.$enums[enumName].value(this[enumName])\n    }\n\n    $get(attrNameOrPath) {\n      return _.get(this, attrNameOrPath)\n    }\n\n    $has(attrNameOrPath) {\n      // TODO: should it be _.hasIn(), to include inherited properties?\n      // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for its exitence.\n      // It can have side effects!\n      return _.has(this, attrNameOrPath)\n    }\n\n    $pick(...attrNamesOrPathes) {\n      return _.pick(this, ...attrNamesOrPathes)\n    }\n\n    $present(attrNameOrPath) {\n      return _.present(this.$get(attrNameOrPath))\n    }\n\n    $set(attrNameOrPath, value) {\n      return _.set(this, attrNameOrPath, value)\n    }\n  }\n\n  return AttributableClass\n}\n\n\nexport default Attributable\n","import _                      from '@caiena/lodash-ext'\nimport mixin                  from '../mixin'\nimport { defineInternalProp, writablePropNames } from '../meta'\n\n\n\nfunction belongsTo(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(value) {\n      if (value == null) { // null or undefined\n        return this.$relations[relationName] = value\n      }\n\n      if (_.isArray(value)) throw new Error(\"can't assign an array to a belongsTo relation\")\n\n      // TODO: should we assign values to fks? `${relation}_id``\n\n      if (value instanceof ModelClass) {\n        return this.$relations[relationName] = value\n      } else {\n        // construct model instance with value as attributes\n        return this.$relations[relationName] = new ModelClass(value)\n      }\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction hasOne(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(value) {\n      if (value == null) { // null or undefined\n        return this.$relations[relationName] = value\n      }\n\n      if (_.isArray(value)) throw new Error(\"can't assign an array to a hasOne relation\")\n\n      if (value instanceof ModelClass) {\n        return this.$relations[relationName] = value\n      } else {\n        // construct model instance with value as attributes\n        return this.$relations[relationName] = new ModelClass(value)\n      }\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction hasMany(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(values) {\n      if (values == null) { // null or undefined\n        return this.$relations[relationName] = []\n      }\n\n      if (!_.isArray(values)) throw new Error(\"can't assign a non-array value to a hasMany relation\")\n\n      // TODO: should we assign values to fks? `${relation}_id`\n\n      let modelInstances = _.map(values, (value) => {\n        return value instanceof ModelClass ? value : new ModelClass(value)\n      })\n\n      return this.$relations[relationName] = modelInstances\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction defineRelation(instance, relationName, config, { get, set } = {}) {\n  switch (config.type) {\n    case 'belongsTo': return belongsTo(...arguments)\n    case 'hasMany':   return hasMany(...arguments)\n    case 'hasOne':    return hasOne(...arguments)\n    default: {\n      throw new Error(`Unknown relation type \"${type}\"`)\n    }\n  }\n}\n\n\n\nfunction Relatable(Class) {\n\n  class RelatableClass extends Class {\n\n    // lazy evaluated $relations\n    static get $relations() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$relations')) {\n        this.$$relations = this.$$relations || _.reduce(this.relations, (result, config, name) => {\n          result[name] = config\n          return result\n        }, {})\n      }\n\n      return this.$$relations\n    }\n\n\n    constructor(...args) {\n      super(...args)\n\n      let klass = this.constructor\n\n      defineInternalProp(this, '$$relations', {})\n\n      // defining relations get/set properties\n      _.each(klass.relations, (config, relationName) => {\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(relationName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(relationName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, relationName)\n            defineRelation(this, relationName, config, { get: _descr.get, set: _descr.set })\n          } else {\n            defineRelation(this, relationName, config)\n          }\n        }\n      })\n    }\n\n    get $relations() {\n      // XXX: $relations and $$relations will be confusing...\n      return this.$$relations\n    }\n  }\n\n  return RelatableClass\n}\n\n\nexport default Relatable\n","import _        from '@caiena/lodash-ext'\nimport { i18n } from '@caiena/i18n'\n\n\nfunction Translatable(Class) {\n  class TranslatableClass extends Class {\n    static get i18nScope() {\n      return `models.${this.$modelName}`\n    }\n\n    static $tModelName({ count = 1 } = {}) {\n      return i18n.t(this.i18nScope, { count })\n    }\n\n    static $tAttr(attrName, options = {}) {\n      let scope = `${this.i18nScope}.attributes`\n      return i18n.t(attrName, _.defaults({}, options, { scope }))\n    }\n\n    static $tEnum(enumName, enumValue = undefined, options = {}) {\n      let scope = this.i18nScope\n      let key = null\n\n      if (enumValue === undefined) {\n        // .attributes.${enumName}\n        scope += '.attributes'\n        key = enumName\n      } else {\n        // .enums.${enumName}.${enumValue}\n        scope += `.enums.${enumName}`\n        key = enumValue\n      }\n\n      return i18n.t(key, _.defaults({}, options, { scope }))\n    }\n\n    // TODO: localize attribute\n    // $l(attrName) {\n    //  // checkout type definition for date or datetime\n    //  // use $l('date', attrName)\n    //  // or  $l('time', attrName)\n    // }\n  }\n\n  return TranslatableClass\n}\n\n\nexport default Translatable\n","// @see https://validatejs.org/#validators-datetime\n// We're addming moment\n\nimport validate from 'validate.js'\nimport _        from '@caiena/lodash-ext'\nimport moment   from 'moment'\n\n\n// Before using it we must add the parse and format functions\n// Here is a sample implementation using moment.js\nvalidate.extend(validate.validators.datetime, {\n  // The value is guaranteed not to be null or undefined but otherwise it\n  // could be anything.\n  parse(value, options) {\n    // return +moment.utc(value)\n    return moment.utc(value)\n  },\n  // Input is a unix timestamp\n  format(value, options) {\n    var format = options.dateOnly ? 'YYYY-MM-DD' : 'YYYY-MM-DD hh:mm:ss'\n    return moment.utc(value).format(format)\n  }\n})\n\n\nexport default validate.validators.datetime\n","import validate from 'validate.js'\nimport _        from '@caiena/lodash-ext'\n\n// XXX overwriting presence validator.\n//\nfunction presence(value, options, key, attrs) {\n  let opts = _.merge({}, this.options, options)\n\n  if (_.blank(value)) {\n    return opts.message || this.message || \"can't be blank\";\n  }\n\n  // returning nothing means \"is valid\"\n}\n\nvalidate.validators.presence = presence\n\nexport default presence\n","import _        from '@caiena/lodash-ext'\nimport { i18n } from '@caiena/i18n'\nimport { defineInternalProp } from '../meta'\nimport validate from 'validate.js'\nimport '../validators/register'\n\n\n// custom error formatter, creating a code/values interpolation scheme with i18n\n// @see http://validatejs.org/#validate-error-formatting\nfunction transformErrors(i18nScope, errors) {\n  // errors sample:\n  // [\n  //   {\n  //     \"attribute\": \"username\",\n  //     \"value\": \"nicklas\",\n  //     \"validator\": \"exclusion\",\n  //     \"globalOptions\": {\n  //       \"format\": \"detailed\"\n  //     },\n  //     \"attributes\": {\n  //       \"username\": \"nicklas\",\n  //       \"password\": \"bad\"\n  //     },\n  //     \"options\": {\n  //       \"within\": [\n  //         \"nicklas\"\n  //       ],\n  //       \"message\": \"'%{value}' is not allowed\"\n  //     },\n  //     \"error\": \"Username 'nicklas' is not allowed\"\n  //   },\n  //   {\n  //     \"attribute\": \"password\",\n  //     \"value\": \"bad\",\n  //     \"validator\": \"length\",\n  //     \"globalOptions\": {\n  //       \"format\": \"detailed\"\n  //     },\n  //     \"attributes\": {\n  //       \"username\": \"nicklas\",\n  //       \"password\": \"bad\"\n  //     },\n  //     \"options\": {\n  //       \"minimum\": 6,\n  //       \"message\": \"must be at least 6 characters\"\n  //     },\n  //     \"error\": \"Password must be at least 6 characters\"\n  //   }\n  // ]\n  errors = validate.groupErrorsByAttribute(errors)\n  let transformedErrors = {}\n\n  for (let attr in errors) {\n    transformedErrors[attr] = []\n\n    for (let error of errors[attr]) {\n      let code = error.validator\n      let message = _.get(error, 'options.message') ||\n        i18n.t(`errors.${code}`, {\n          scope: i18nScope,\n          defaultValue: i18n.t(`errors.${code}`),\n          value: error.value\n        })\n\n      transformedErrors[attr].push({\n        attribute: error.attribute,\n        value: error.value,\n        code,\n        message\n      })\n    }\n  }\n\n  return transformedErrors\n}\n\n\n// validates a Model instance\n// extracted to this private function because we can use it recursively on any related model\n// if options and configurations demands it. (like `instance.$validate({ relations: true })`)\nfunction _validate(instance) {\n  let constraints = instance.constructor.constraints\n  // let instance = instance\n\n  // adapting api to .then(success, error) to .then(success).catch(error)\n  return new Promise((resolve, reject) => {\n    // - cleanAttributes: false - to tell validatejs not to delete empty or without constraint attributes\n    // @see https://validatejs.org/#validate-async\n    //   > Besides accepting all options as the non async validation function it also accepts\n    //   > two additional options; cleanAttributes which, unless false, makes validate.async\n    //   > call validate.cleanAttributes before resolving the promise (...)\n    // @see https://validatejs.org/#utilities-clean-attributes\n    validate.async(instance, constraints, { format: 'detailed', cleanAttributes: false })\n      .then(\n        function success(attributes) {\n          // reset errors\n          instance.$$errors = {}\n          resolve(true)\n        },\n\n        function error(errors) {\n          if (errors instanceof Error) {\n            // runtime Error. Just throw it\n            // reset errors\n            instance.$$errors = {}\n            reject(errors)\n          } else {\n            // validation error.\n            // assign to $errors\n            instance.$$errors = transformErrors(instance.constructor.i18nScope, errors)\n            resolve(false)\n          }\n        })\n  })\n}\n\n\nfunction Validatable(Class) {\n\n  class ValidatableClass extends Class {\n\n    constructor(...args) {\n      super(...args)\n      defineInternalProp(this, '$$errors', {})\n    }\n\n    get $errors() {\n      return this.$$errors\n    }\n\n    static get $constraints() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$constraints')) {\n        this.$$constraints = _.clone(this.constraints)\n      }\n\n      return this.$$constraints\n    }\n\n    async $validate({ relations = false } = {}) {\n      let instance = this\n      let promises = []\n\n      promises.push(_validate(instance))\n\n      if (relations) {\n        let relationNames = Object.keys(instance.$relations)\n        let relations = _.pickBy(instance, function (relationData, relationName) {\n          return relationNames.includes(relationName) && _.present(relationData)\n        })\n\n        _.each(relations, (relationData, _relationName) => {\n\n          if (Array.isArray(relationData)) {\n            relationData.forEach(relatedInstance => promises.push(_validate((relatedInstance))))\n\n          } else {\n            promises.push(_validate(relationData))\n          }\n        })\n      }\n\n      try {\n        let responses = await Promise.all(promises)\n        let hasError = responses.includes(false)\n\n        return hasError ? Promise.resolve(false) : Promise.resolve(true)\n\n      } catch (error) {\n        return Promise.reject(error)\n      }\n    }\n  }\n\n  return ValidatableClass\n}\n\n\nexport default Validatable\n","import _                     from '@caiena/lodash-ext'\nimport { writablePropNames } from './meta'\nimport mixin                 from './mixin'\nimport Attributable          from './mixins/attributable'\nimport Relatable             from './mixins/relatable'\nimport Translatable          from './mixins/translatable'\nimport Validatable           from './mixins/validatable'\n\nfunction _serializeObject(obj) {\n  return _.reduce(obj, (serialized, value, key) => {\n    serialized[key] = _serialize(value)\n    return serialized\n  }, {})\n}\n\nfunction _serialize(value) {\n  if (Array.isArray(value)) return value.map(_serialize)\n\n  if (_.isObjectLike(value)) {\n    return (typeof value.toJSON === 'function') ? value.toJSON() : _serializeObject(value)\n  }\n\n  return value\n}\n\nclass Base {\n  static get $modelNameAdapter() { return _.camelize }\n  static get $modelName()        { return this.$modelNameAdapter(this.name) }\n\n  static get attrs()     { return [] }\n  static get enums()     { return {} }\n  static get virtuals()  { return [] }\n\n  static $lookupModel(name) {\n    throw new Error('Model.$lookupModel(name) is not implemented.')\n  }\n}\n\nclass Model extends mixin(Base, [Attributable, Relatable, Translatable, Validatable]) {\n  static get $$model() { return true } // allow programmatically checking if it's a model class\n\n  // using \"props\" as name to make it explicit that we'll set any enumerable \"property\" in the instance\n  // (JavaScript land - getOwnPropertyDescriptor() and prototype)\n  constructor(props = {}, { undefs = true } = {}) {\n    super()\n\n    this.$beforeInit(...arguments) // hook for user land\n\n    let propNames = writablePropNames(this)\n    let sanitizedProps = _.pick(props, propNames)\n\n    if (undefs) {\n      // start all props with undefined, allowing them to be observed (rxjs, Vue, ...)\n      let undefProps = _.reduce(propNames, (undefProps, name) => {\n        undefProps[name] = undefined\n        return undefProps\n      }, {})\n\n      // adding undefs if not defined yet\n      // _.defaults(sanitizedProps, undefProps)\n      // XXX: using _.merge() here to keep properties names sorted\n      sanitizedProps = _.merge(undefProps, sanitizedProps)\n    }\n\n    // set props, one-by-one, using setter method\n    _.each(sanitizedProps, (value, name) => {\n      this[name] = value\n    })\n\n    this.$afterInit(...arguments) // hook for user land\n  }\n\n  $beforeInit(...args) {\n    // override it in subclasses\n  }\n\n  $afterInit(...args) {\n    // override it in subclasses\n  }\n\n  toJSON({ pick = [], include = [], omit = [], virtuals = false, relations = false, undefs = false } = {}) {\n    let json = _.clone(this.$attrs)\n\n\n    if (virtuals) {\n      _.merge(json, _.pick(this, this.constructor.virtuals))\n    }\n\n    if (relations) {\n      let  modelRelations = Object.keys(this.$relations)\n      _.merge(json, _.pick(this, modelRelations))\n    }\n\n    if (_.present(pick)) {\n      json = _.pick(json, pick)\n    }\n\n    if (_.present(include)) {\n      json = _.merge(json, _.pick(this, include))\n    }\n\n    if (_.present(omit)) {\n      json = _.omit(json, omit)\n    }\n\n    if (!undefs) {\n      json = _.pickBy(json, (val, key) => !_.isUndefined(val))\n    }\n\n    json = _.reduce(json, (serialized, value, propName) => {\n      serialized[propName] = _serialize(value)\n\n      return serialized\n    }, {})\n\n\n    return json\n  }\n\n  $serialize(...args) {\n    return this.toJSON(...args)\n  }\n}\n\n\nexport default Model\n","import _ from '@caiena/lodash-ext'\nimport Model from '../model'\n\n\nfunction Decorator(ModelClass) {\n\n  class DecoratedClass extends ModelClass {\n    static get $modelClass() { return ModelClass }\n\n    constructor(object) {\n      let _object = (object instanceof Model) ? object : new ModelClass(object)\n\n      // sanity check\n      if (_object.hasOwnProperty('$object')) {\n        throw new Error('Decorated object cannot have a property named \"$object\"')\n      }\n\n      super({ $object: _object, ..._object.$props })\n    }\n\n    // hook to define $object before constructing the model instance\n    $beforeInit(props, opts) {\n      this.$object = props.$object\n\n      super.$beforeInit(props, opts)\n    }\n  }\n\n  return DecoratedClass\n}\n\n\nexport default Decorator\n","import _ from '@caiena/lodash-ext'\nimport * as contents from './*.yml'\n\nconst translations = {}\n\n_.each(contents, (content, _id) => {\n  _.merge(translations, content)\n})\n\n\nexport default translations\n"],"names":["defineInternalProp","obj","prop","value","Object","defineProperty","enumerable","writable","configurable","writableProp","instance","name","_","includes","startsWith","descriptor","hasOwnProperty","getOwnPropertyDescriptor","prototype","getPrototypeOf","set","writablePropNames","propNames","chain","getOwnPropertyNames","concat","uniq","sort","filter","mixin","Class","mixins","reduce","MixedClass","Mixin","defineAttr","attrName","get","$attrs","defineEnum","enumName","key","constructor","$enums","Attributable","AttributableClass","args","klass","each","enumeration","Error","_proto","_descr","$$attrs","attrs","sanitizedAttrs","pick","proto","props","propName","attrNameOrPath","blank","$get","has","attrNamesOrPathes","present","$$enums","enums","result","Enum","clone","$$virtuals","virtuals","belongsTo","relationName","config","$relations","ModelClass","model","$$model","$lookupModel","isArray","hasOne","hasMany","values","modelInstances","map","defineRelation","type","arguments","Relatable","RelatableClass","relations","$$relations","Translatable","TranslatableClass","$modelName","count","i18n","t","i18nScope","options","scope","defaults","enumValue","undefined","validate","extend","validators","datetime","parse","moment","utc","format","dateOnly","presence","opts","merge","message","transformErrors","errors","groupErrorsByAttribute","transformedErrors","attr","error","code","validator","defaultValue","push","attribute","_validate","constraints","Promise","resolve","reject","async","cleanAttributes","then","success","attributes","$$errors","Validatable","ValidatableClass","promises","relationNames","keys","pickBy","relationData","_relationName","Array","forEach","relatedInstance","all","responses","hasError","$$constraints","_serializeObject","serialized","_serialize","isObjectLike","toJSON","Base","camelize","$modelNameAdapter","Model","undefs","$beforeInit","sanitizedProps","undefProps","$afterInit","include","omit","json","modelRelations","val","isUndefined","Decorator","DecoratedClass","object","_object","$object","$props","translations","contents","content","_id"],"mappings":"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"}