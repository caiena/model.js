{"version":3,"file":"model.cjs.js","sources":["../src/meta.js","../src/mixin.js","../src/mixins/attributable.js","../src/mixins/relatable.js","../src/mixins/translatable.js","../src/validators/datetime.js","../src/validators/presence.js","../src/mixins/validatable.js","../src/model.js","../src/mixins/decorator.js","../src/config/i18n/translations.js"],"sourcesContent":["// utility function for metaprogramming\n\nimport _ from '@caiena/lodash-ext'\n\n\nfunction defineInternalProp(obj, prop, value) {\n  Object.defineProperty(obj, prop, {\n    enumerable: false,\n    writable: true,\n    configurable: true,\n    value\n  })\n}\n\n\n// checks for property in instance or its prototype\nfunction writableProp(instance, name) {\n  // avoiding reserved props (e.g. constructor) or names starting with $ - model.js \"meta\" props\n  if (_.includes(['constructor'], name) || _.startsWith(name, '$')) return false\n\n  let descriptor = null\n\n  if (instance.hasOwnProperty(name)) {\n    descriptor = Object.getOwnPropertyDescriptor(instance, name)\n  } else {\n    // falling back to prototype\n    let prototype = Object.getPrototypeOf(instance)\n    descriptor = Object.getOwnPropertyDescriptor(prototype, name)\n  }\n\n  return !!descriptor.set || (descriptor.writable === true)\n}\n\n\n// checks for property in instance or its prototype\nfunction writablePropNames(instance) {\n  let prototype = Object.getPrototypeOf(instance)\n  let propNames = _.chain(Object.getOwnPropertyNames(instance))\n    .concat(Object.getOwnPropertyNames(prototype))\n    .uniq()\n    .value()\n    .sort()\n\n  return _.filter(propNames, (name) => writableProp(instance, name))\n}\n\n\n// can't export default and import named destructuring. So we're exporting named (non-default).\n// https://github.com/babel/babel-loader/issues/194\nexport {\n  defineInternalProp,\n  writableProp,\n  writablePropNames\n}\n","// @see https://github.com/Vincit/objection.js/blob/2f7dd232aec1b1b3d880d10e75b169af2554ea91/lib/utils/mixin.js\nimport _ from '@caiena/lodash-ext'\n\n\nfunction mixin(Class, mixins) {\n  return mixins.reduce((MixedClass, Mixin) => Mixin(MixedClass), Class)\n}\n\n\nexport default mixin\n","import _                      from '@caiena/lodash-ext'\nimport Enum                   from '@caiena/enum'\nimport mixin                  from '../mixin'\nimport { defineInternalProp, writablePropNames } from '../meta'\n\n\n\nfunction defineAttr(obj, attrName, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$attrs[attrName]\n    }\n  }\n\n  if (!set) {\n    set = function set(value) {\n      return this.$attrs[attrName] = value\n    }\n  }\n\n  Object.defineProperty(obj, attrName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\nfunction defineEnum(obj, enumName, { get = null, set = null } = {}) {\n  // custom setter for enums\n  if (!set) {\n    set = function set(value) {\n      // ensures setting the key as attr value\n      let key = this.constructor.$enums[enumName].key(value)\n      return this.$attrs[enumName] = key\n    }\n  }\n\n  defineAttr(obj, enumName, { get, set })\n}\n\n\n\nfunction Attributable(Class) {\n\n  class AttributableClass extends Class {\n\n    // lazy evaluated $enums, using @caiena/enum\n    static get $enums() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$enums')) {\n        this.$$enums = _.reduce(this.enums, (result, enumeration, enumName) => {\n          // transform to Enum instance, if needed\n          result[enumName] = (enumeration instanceof Enum) ? enumeration : new Enum(enumeration)\n\n          return result\n        }, {})\n      }\n\n      return this.$$enums\n    }\n\n    // lazy evaluated $attrs\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $attrs() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$attrs')) {\n        this.$$attrs = _.clone(this.attrs)\n      }\n\n      return this.$$attrs\n    }\n\n\n    // lazy evaluated $virtuals\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $virtuals() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$virtuals')) {\n        this.$$virtuals = _.clone(this.virtuals)\n      }\n\n      return this.$$virtuals\n    }\n\n\n    constructor(...args) {\n      super(...args)\n\n      let klass = this.constructor\n\n      defineInternalProp(this, '$$attrs', {})\n\n      // handling enums first then attrs, avoiding overrides\n      // defining enums get/set properties\n      _.each(klass.$enums, (enumeration, enumName) => {\n        // sanity check!\n        // enum must be defined in attrs list as well\n        if (!_.includes(klass.$attrs, enumName)) {\n          throw new Error(`enum \"${enumName}\" is not listed as an attribute in model ${klass.name}`)\n        }\n\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(enumName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(enumName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, enumName)\n            defineEnum(this, enumName, { get: _descr.get, set: _descr.set })\n          } else {\n            defineEnum(this, enumName)\n          }\n        }\n      })\n\n      // defining attrs get/set properties\n      _.each(klass.$attrs, (attrName) => {\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(attrName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(attrName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, attrName)\n            defineAttr(this, attrName, { get: _descr.get, set: _descr.set })\n          } else {\n            defineAttr(this, attrName)\n          }\n        }\n      })\n    }\n\n    get $attrs() {\n      // XXX: $attrs and $$attrs will be confusing...\n      return this.$$attrs\n    }\n\n    set $attrs(attrs) {\n      // TODO: remove old code\n      // return _.merge(this.$$attrs, attrs)\n\n      // set props, one-by-one, using setter method\n      let sanitizedAttrs = _.pick(attrs, this.constructor.$attrs)\n      _.each(sanitizedAttrs, (value, name) => {\n        this[name] = value\n      })\n    }\n\n    // TODO: remove it?\n    get $props() {\n      let instance = this\n      let proto = Object.getPrototypeOf(this)\n      let propNames = _.chain(Object.getOwnPropertyNames(proto))\n        .concat(Object.getOwnPropertyNames(instance))\n        .filter((name) => !(_.includes(['constructor'], name) || _.startsWith(name, '$')))\n        .uniq()\n        .value()\n        .sort()\n\n      return _.reduce(propNames, (props, propName) => {\n        props[propName] = this[propName]\n        return props\n      }, {})\n    }\n\n    $blank(attrNameOrPath) {\n      return _.blank(this.$get(attrNameOrPath))\n    }\n\n    $enumValue(enumName) {\n      return this.constructor.$enums[enumName].value(this[enumName])\n    }\n\n    $get(attrNameOrPath) {\n      return _.get(this, attrNameOrPath)\n    }\n\n    $has(attrNameOrPath) {\n      // TODO: should it be _.hasIn(), to include inherited properties?\n      // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for its exitence.\n      // It can have side effects!\n      return _.has(this, attrNameOrPath)\n    }\n\n    $pick(...attrNamesOrPathes) {\n      return _.pick(this, ...attrNamesOrPathes)\n    }\n\n    $present(attrNameOrPath) {\n      return _.present(this.$get(attrNameOrPath))\n    }\n\n    $set(attrNameOrPath, value) {\n      return _.set(this, attrNameOrPath, value)\n    }\n  }\n\n  return AttributableClass\n}\n\n\nexport default Attributable\n","import _                      from '@caiena/lodash-ext'\nimport mixin                  from '../mixin'\nimport { defineInternalProp, writablePropNames } from '../meta'\n\n\n\nfunction belongsTo(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(value) {\n      if (value == null) { // null or undefined\n        return this.$relations[relationName] = value\n      }\n\n      if (_.isArray(value)) throw new Error(\"can't assign an array to a belongsTo relation\")\n\n      // TODO: should we assign values to fks? `${relation}_id``\n\n      if (value instanceof ModelClass) {\n        return this.$relations[relationName] = value\n      } else {\n        // construct model instance with value as attributes\n        return this.$relations[relationName] = new ModelClass(value)\n      }\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction hasOne(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(value) {\n      if (value == null) { // null or undefined\n        return this.$relations[relationName] = value\n      }\n\n      if (_.isArray(value)) throw new Error(\"can't assign an array to a hasOne relation\")\n\n      if (value instanceof ModelClass) {\n        return this.$relations[relationName] = value\n      } else {\n        // construct model instance with value as attributes\n        return this.$relations[relationName] = new ModelClass(value)\n      }\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction hasMany(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(values) {\n      if (values == null) { // null or undefined\n        return this.$relations[relationName] = []\n      }\n\n      if (!_.isArray(values)) throw new Error(\"can't assign a non-array value to a hasMany relation\")\n\n      // TODO: should we assign values to fks? `${relation}_id`\n\n      let modelInstances = _.map(values, (value) => {\n        return value instanceof ModelClass ? value : new ModelClass(value)\n      })\n\n      return this.$relations[relationName] = modelInstances\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction defineRelation(instance, relationName, config, { get, set } = {}) {\n  switch (config.type) {\n    case 'belongsTo': return belongsTo(...arguments)\n    case 'hasMany':   return hasMany(...arguments)\n    case 'hasOne':    return hasOne(...arguments)\n    default: {\n      throw new Error(`Unknown relation type \"${type}\"`)\n    }\n  }\n}\n\n\n\nfunction Relatable(Class) {\n\n  class RelatableClass extends Class {\n\n    // lazy evaluated $relations\n    static get $relations() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$relations')) {\n        this.$$relations = this.$$relations || _.reduce(this.relations, (result, config, name) => {\n          result[name] = config\n          return result\n        }, {})\n      }\n\n      return this.$$relations\n    }\n\n\n    constructor(...args) {\n      super(...args)\n\n      let klass = this.constructor\n\n      defineInternalProp(this, '$$relations', {})\n\n      // defining relations get/set properties\n      _.each(klass.relations, (config, relationName) => {\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(relationName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(relationName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, relationName)\n            defineRelation(this, relationName, config, { get: _descr.get, set: _descr.set })\n          } else {\n            defineRelation(this, relationName, config)\n          }\n        }\n      })\n    }\n\n    get $relations() {\n      // XXX: $relations and $$relations will be confusing...\n      return this.$$relations\n    }\n  }\n\n  return RelatableClass\n}\n\n\nexport default Relatable\n","import _        from '@caiena/lodash-ext'\nimport { i18n } from '@caiena/i18n'\n\n\nfunction Translatable(Class) {\n  class TranslatableClass extends Class {\n    static get i18nScope() {\n      return `models.${this.$modelName}`\n    }\n\n    static $tModelName({ count = 1 } = {}) {\n      return i18n.t(this.i18nScope, { count })\n    }\n\n    static $tAttr(attrName, options = {}) {\n      let scope = `${this.i18nScope}.attributes`\n      return i18n.t(attrName, _.defaults({}, options, { scope }))\n    }\n\n    static $tEnum(enumName, enumValue = undefined, options = {}) {\n      let scope = this.i18nScope\n      let key = null\n\n      if (enumValue === undefined) {\n        // .attributes.${enumName}\n        scope += '.attributes'\n        key = enumName\n      } else {\n        // .enums.${enumName}.${enumValue}\n        scope += `.enums.${enumName}`\n        key = enumValue\n      }\n\n      return i18n.t(key, _.defaults({}, options, { scope }))\n    }\n\n    // TODO: localize attribute\n    // $l(attrName) {\n    //  // checkout type definition for date or datetime\n    //  // use $l('date', attrName)\n    //  // or  $l('time', attrName)\n    // }\n  }\n\n  return TranslatableClass\n}\n\n\nexport default Translatable\n","// @see https://validatejs.org/#validators-datetime\n// We're addming moment\n\nimport validate from 'validate.js'\nimport _        from '@caiena/lodash-ext'\nimport moment   from 'moment'\n\n\n// Before using it we must add the parse and format functions\n// Here is a sample implementation using moment.js\nvalidate.extend(validate.validators.datetime, {\n  // The value is guaranteed not to be null or undefined but otherwise it\n  // could be anything.\n  parse(value, options) {\n    // return +moment.utc(value)\n    return moment.utc(value)\n  },\n  // Input is a unix timestamp\n  format(value, options) {\n    var format = options.dateOnly ? 'YYYY-MM-DD' : 'YYYY-MM-DD hh:mm:ss'\n    return moment.utc(value).format(format)\n  }\n})\n\n\nexport default validate.validators.datetime\n","import validate from 'validate.js'\nimport _        from '@caiena/lodash-ext'\n\n// XXX overwriting presence validator.\n//\nfunction presence(value, options, key, attrs) {\n  let opts = _.merge({}, this.options, options)\n\n  if (_.blank(value)) {\n    return opts.message || this.message || \"can't be blank\";\n  }\n\n  // returning nothing means \"is valid\"\n}\n\nvalidate.validators.presence = presence\n\nexport default presence\n","import _        from '@caiena/lodash-ext'\nimport { i18n } from '@caiena/i18n'\nimport { defineInternalProp } from '../meta'\nimport validate from 'validate.js'\nimport '../validators/register'\n\n\n// custom error formatter, creating a code/values interpolation scheme with i18n\n// @see http://validatejs.org/#validate-error-formatting\nfunction transformErrors(i18nScope, errors) {\n  // errors sample:\n  // // => [\n  //   {\n  //     \"attribute\": \"username\",\n  //     \"value\": \"nicklas\",\n  //     \"validator\": \"exclusion\",\n  //     \"globalOptions\": {\n  //       \"format\": \"detailed\"\n  //     },\n  //     \"attributes\": {\n  //       \"username\": \"nicklas\",\n  //       \"password\": \"bad\"\n  //     },\n  //     \"options\": {\n  //       \"within\": [\n  //         \"nicklas\"\n  //       ],\n  //       \"message\": \"'%{value}' is not allowed\"\n  //     },\n  //     \"error\": \"Username 'nicklas' is not allowed\"\n  //   },\n  //   {\n  //     \"attribute\": \"password\",\n  //     \"value\": \"bad\",\n  //     \"validator\": \"length\",\n  //     \"globalOptions\": {\n  //       \"format\": \"detailed\"\n  //     },\n  //     \"attributes\": {\n  //       \"username\": \"nicklas\",\n  //       \"password\": \"bad\"\n  //     },\n  //     \"options\": {\n  //       \"minimum\": 6,\n  //       \"message\": \"must be at least 6 characters\"\n  //     },\n  //     \"error\": \"Password must be at least 6 characters\"\n  //   }\n  // ]\n  errors = validate.groupErrorsByAttribute(errors)\n  let transformedErrors = {}\n\n  for (let attr in errors) {\n    transformedErrors[attr] = []\n\n    for (let error of errors[attr]) {\n      let code = error.validator\n      let message = _.get(error, 'options.message') ||\n        i18n.t(`errors.${code}`, {\n          scope: i18nScope,\n          defaultValue: i18n.t(`errors.${code}`),\n          value: error.value\n        })\n\n      transformedErrors[attr].push({\n        attribute: error.attribute,\n        value: error.value,\n        code,\n        message\n      })\n    }\n  }\n\n  return transformedErrors\n}\n\n\nfunction Validatable(Class) {\n\n  class ValidatableClass extends Class {\n\n    constructor(...args) {\n      super(...args)\n      defineInternalProp(this, '$$errors', {})\n    }\n\n    get $errors() {\n      return this.$$errors\n    }\n\n    static get $constraints() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$constraints')) {\n        this.$$constraints = _.clone(this.constraints)\n      }\n\n      return this.$$constraints\n    }\n\n    async $validate() {\n      let constraints = this.constructor.constraints\n      let instance = this\n\n      // adapting api to .then(success, error) to .then(success).catch(error)\n      return new Promise((resolve, reject) => {\n        // - cleanAttributes: false - to tell validatejs not to delete empty or without constraint attributes\n        // @see https://validatejs.org/#validate-async\n        //   > Besides accepting all options as the non async validation function it also accepts\n        //   > two additional options; cleanAttributes which, unless false, makes validate.async\n        //   > call validate.cleanAttributes before resolving the promise (...)\n        // @see https://validatejs.org/#utilities-clean-attributes\n        validate.async(this, constraints, { format: 'detailed', cleanAttributes: false })\n          .then(\n            function success(attributes) {\n              // reset errors\n              instance.$$errors = {}\n              resolve(true)\n            },\n\n            function error(errors) {\n              if (errors instanceof Error) {\n                // runtime Error. Just throw it\n                // reset errors\n                instance.$$errors = {}\n                reject(errors)\n              } else {\n                // validation error.\n                // assign to $errors\n                instance.$$errors = transformErrors(instance.constructor.i18nScope, errors)\n                resolve(false)\n              }\n            })\n      })\n    }\n  }\n\n  return ValidatableClass\n}\n\n\nexport default Validatable\n","import _                     from '@caiena/lodash-ext'\nimport { writablePropNames } from './meta'\nimport mixin                 from './mixin'\nimport Attributable          from './mixins/attributable'\nimport Relatable             from './mixins/relatable'\nimport Translatable          from './mixins/translatable'\nimport Validatable           from './mixins/validatable'\n\n\nclass Base {\n  static get $modelNameAdapter() { return _.camelize }\n  static get $modelName()        { return this.$modelNameAdapter(this.name) }\n\n  static get attrs()     { return [] }\n  static get enums()     { return {} }\n  static get virtuals()  { return [] }\n\n  static $lookupModel(name) {\n    throw new Error('Model.$lookupModel(name) is not implemented.')\n  }\n}\n\nclass Model extends mixin(Base, [Attributable, Relatable, Translatable, Validatable]) {\n  static get $$model() { return true } // allow programmatically checking if it's a model class\n\n  // using \"props\" as name to make it explicit that we'll set any enumerable \"property\" in the instance\n  // (JavaScript land - getOwnPropertyDescriptor() and prototype)\n  constructor(props = {}, { undefs = true } = {}) {\n    super()\n\n    this.$beforeInit(...arguments) // hook for user land\n\n    let propNames = writablePropNames(this)\n    let sanitizedProps = _.pick(props, propNames)\n\n    if (undefs) {\n      // start all props with undefined, allowing them to be observed (rxjs, Vue, ...)\n      let undefProps = _.reduce(propNames, (undefProps, name) => {\n        undefProps[name] = undefined\n        return undefProps\n      }, {})\n\n      // adding undefs if not defined yet\n      // _.defaults(sanitizedProps, undefProps)\n      // XXX: using _.merge() here to keep properties names sorted\n      sanitizedProps = _.merge(undefProps, sanitizedProps)\n    }\n\n    // set props, one-by-one, using setter method\n    _.each(sanitizedProps, (value, name) => {\n      this[name] = value\n    })\n\n    this.$afterInit(...arguments) // hook for user land\n  }\n\n  $beforeInit(...args) {\n    // override it in subclasses\n  }\n\n  $afterInit(...args) {\n    // override it in subclasses\n  }\n\n  toJSON({ pick = [], include = [], omit = [], virtuals = false, relations = false, undefs = false } = {}) {\n    let json = _.clone(this.$attrs)\n\n    if (!undefs) {\n      json = _.pickBy(json, (val, key) => !_.isUndefined(val))\n    }\n\n    if (virtuals) {\n      _.merge(json, _.pick(this, this.constructor.virtuals))\n    }\n\n    if (relations) { // TODO: test it\n      _.merge(json, _.pick(this, this.constructor.$relations))\n    }\n\n    if (_.present(pick)) {\n      json = _.pick(json, pick)\n    }\n\n    if (_.present(include)) {  // TODO: test it\n      json = _.merge(json, _.pick(this, include))\n    }\n\n    if (_.present(omit)) {\n      json = _.omit(json, omit)\n    }\n\n    return json\n  }\n\n  $serialize(...args) {\n    return this.toJSON(...args)\n  }\n}\n\n\nexport default Model\n","import _ from '@caiena/lodash-ext'\nimport Model from '../model'\n\n\nfunction Decorator(ModelClass) {\n\n  class DecoratedClass extends ModelClass {\n    static get $modelClass() { return ModelClass }\n\n    constructor(object) {\n      let _object = (object instanceof Model) ? object : new ModelClass(object)\n\n      // sanity check\n      if (_object.hasOwnProperty('$object')) {\n        throw new Error('Decorated object cannot have a property named \"$object\"')\n      }\n\n      super({ $object: _object, ..._object.$props })\n    }\n\n    // hook to define $object before constructing the model instance\n    $beforeInit(props, opts) {\n      this.$object = props.$object\n\n      super.$beforeInit(props, opts)\n    }\n  }\n\n  return DecoratedClass\n}\n\n\nexport default Decorator\n","import _ from '@caiena/lodash-ext'\nimport * as contents from './*.yml'\n\nconst translations = {}\n\n_.each(contents, (content, _id) => {\n  _.merge(translations, content)\n})\n\n\nexport default translations\n"],"names":["defineInternalProp","obj","prop","value","Object","defineProperty","enumerable","writable","configurable","writableProp","instance","name","_","includes","startsWith","descriptor","hasOwnProperty","getOwnPropertyDescriptor","prototype","getPrototypeOf","set","writablePropNames","propNames","chain","getOwnPropertyNames","concat","uniq","sort","filter","mixin","Class","mixins","reduce","MixedClass","Mixin","defineAttr","attrName","get","$attrs","defineEnum","enumName","key","constructor","$enums","Attributable","AttributableClass","$$enums","enums","result","enumeration","Enum","$$attrs","clone","attrs","$virtuals","$$virtuals","virtuals","args","klass","each","Error","_proto","_descr","sanitizedAttrs","pick","$props","proto","props","propName","$blank","attrNameOrPath","blank","$get","$enumValue","$has","has","$pick","attrNamesOrPathes","$present","present","$set","belongsTo","relationName","config","$relations","ModelClass","model","$$model","$lookupModel","isArray","hasOne","hasMany","values","modelInstances","map","defineRelation","type","arguments","Relatable","RelatableClass","$$relations","relations","Translatable","TranslatableClass","i18nScope","$modelName","$tModelName","count","i18n","t","$tAttr","options","scope","defaults","$tEnum","enumValue","undefined","validate","extend","validators","datetime","parse","moment","utc","format","dateOnly","presence","opts","merge","message","transformErrors","errors","groupErrorsByAttribute","transformedErrors","attr","error","code","validator","defaultValue","push","attribute","Validatable","ValidatableClass","$errors","$$errors","$constraints","$$constraints","constraints","$validate","Promise","resolve","reject","async","cleanAttributes","then","success","attributes","Base","$modelNameAdapter","camelize","Model","undefs","$beforeInit","sanitizedProps","undefProps","$afterInit","toJSON","include","omit","json","pickBy","val","isUndefined","$serialize","Decorator","DecoratedClass","$modelClass","object","_object","$object","translations","contents","content","_id"],"mappings":"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"}