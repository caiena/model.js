{"version":3,"file":"model.cjs.js","sources":["../src/meta.js","../src/mixin.js","../src/mixins/attributable.js","../src/mixins/relatable.js","../src/mixins/translatable.js","../src/validators/datetime.js","../src/validators/presence.js","../src/validators/register.js","../src/mixins/validatable.js","../src/model.js","../src/mixins/decorator.js","../src/config/i18n/translations.js"],"sourcesContent":["// utility function for metaprogramming\n\nimport _ from '@caiena/lodash-ext'\n\n\nfunction defineInternalProp(obj, prop, value) {\n  Object.defineProperty(obj, prop, {\n    enumerable: false,\n    writable: true,\n    configurable: true,\n    value\n  })\n}\n\n\n// checks for property in instance or its prototype\nfunction writableProp(instance, name) {\n  // avoiding reserved props (e.g. constructor) or names starting with $ - model.js \"meta\" props\n  if (_.includes(['constructor'], name) || _.startsWith(name, '$')) return false\n\n  let descriptor = null\n\n  if (instance.hasOwnProperty(name)) {\n    descriptor = Object.getOwnPropertyDescriptor(instance, name)\n  } else {\n    // falling back to prototype\n    let prototype = Object.getPrototypeOf(instance)\n    descriptor = Object.getOwnPropertyDescriptor(prototype, name)\n  }\n\n  return !!descriptor.set || (descriptor.writable === true)\n}\n\n\n// checks for property in instance or its prototype\nfunction writablePropNames(instance) {\n  let prototype = Object.getPrototypeOf(instance)\n  let propNames = _.chain(Object.getOwnPropertyNames(instance))\n    .concat(Object.getOwnPropertyNames(prototype))\n    .uniq()\n    .value()\n    .sort()\n\n  return _.filter(propNames, (name) => writableProp(instance, name))\n}\n\n\n// can't export default and import named destructuring. So we're exporting named (non-default).\n// https://github.com/babel/babel-loader/issues/194\nexport {\n  defineInternalProp,\n  writableProp,\n  writablePropNames\n}\n","// @see https://github.com/Vincit/objection.js/blob/2f7dd232aec1b1b3d880d10e75b169af2554ea91/lib/utils/mixin.js\nimport _ from '@caiena/lodash-ext'\n\n\nfunction mixin(Class, mixins) {\n  return mixins.reduce((MixedClass, Mixin) => Mixin(MixedClass), Class)\n}\n\n\nexport default mixin\n","import _                      from '@caiena/lodash-ext'\nimport Enum                   from '@caiena/enum'\nimport mixin                  from '../mixin'\nimport { defineInternalProp, writablePropNames } from '../meta'\n\n\n\nfunction defineAttr(obj, attrName, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$attrs[attrName]\n    }\n  }\n\n  if (!set) {\n    set = function set(value) {\n      return this.$attrs[attrName] = value\n    }\n  }\n\n  Object.defineProperty(obj, attrName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\nfunction defineEnum(obj, enumName, { get = null, set = null } = {}) {\n  // custom setter for enums\n  if (!set) {\n    set = function set(value) {\n      // ensures setting the key as attr value\n      let key = this.constructor.$enums[enumName].key(value)\n      return this.$attrs[enumName] = key\n    }\n  }\n\n  defineAttr(obj, enumName, { get, set })\n}\n\n\n\nfunction Attributable(Class) {\n\n  class AttributableClass extends Class {\n\n    // lazy evaluated $enums, using @caiena/enum\n    static get $enums() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$enums')) {\n        this.$$enums = _.reduce(this.enums, (result, enumeration, enumName) => {\n          // transform to Enum instance, if needed\n          result[enumName] = (enumeration instanceof Enum) ? enumeration : new Enum(enumeration)\n\n          return result\n        }, {})\n      }\n\n      return this.$$enums\n    }\n\n    // lazy evaluated $attrs\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $attrs() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$attrs')) {\n        this.$$attrs = _.clone(this.attrs)\n      }\n\n      return this.$$attrs\n    }\n\n\n    // lazy evaluated $virtuals\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $virtuals() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$virtuals')) {\n        this.$$virtuals = _.clone(this.virtuals)\n      }\n\n      return this.$$virtuals\n    }\n\n\n    // lazy evaluated $constraints\n    // for now we're only keeping the API consistent, adding a '$methodName' getter\n    // TODO: define types and create \"intelligent\" setters? (with constraints)\n    static get $constraints() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$constraints')) {\n        this.$$constraints = _.clone(this.constraints)\n      }\n\n      return this.$$constraints\n    }\n\n\n    constructor(...args) {\n      super(...args)\n\n      let klass = this.constructor\n\n      defineInternalProp(this, '$$attrs', {})\n\n      // handling enums first then attrs, avoiding overrides\n      // defining enums get/set properties\n      _.each(klass.$enums, (enumeration, enumName) => {\n        // sanity check!\n        // enum must be defined in attrs list as well\n        if (!_.includes(klass.$attrs, enumName)) {\n          throw new Error(`enum \"${enumName}\" is not listed as an attribute in model ${klass.name}`)\n        }\n\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(enumName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(enumName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, enumName)\n            defineEnum(this, enumName, { get: _descr.get, set: _descr.set })\n          } else {\n            defineEnum(this, enumName)\n          }\n        }\n      })\n\n      // defining attrs get/set properties\n      _.each(klass.$attrs, (attrName) => {\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(attrName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(attrName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, attrName)\n            defineAttr(this, attrName, { get: _descr.get, set: _descr.set })\n          } else {\n            defineAttr(this, attrName)\n          }\n        }\n      })\n    }\n\n    get $attrs() {\n      // XXX: $attrs and $$attrs will be confusing...\n      return this.$$attrs\n    }\n\n    set $attrs(attrs) {\n      // TODO: remove old code\n      // return _.merge(this.$$attrs, attrs)\n\n      // set props, one-by-one, using setter method\n      let sanitizedAttrs = _.pick(attrs, this.constructor.$attrs)\n      _.each(sanitizedAttrs, (value, name) => {\n        this[name] = value\n      })\n    }\n\n    // TODO: remove it?\n    get $props() {\n      let instance = this\n      let proto = Object.getPrototypeOf(this)\n      let propNames = _.chain(Object.getOwnPropertyNames(proto))\n        .concat(Object.getOwnPropertyNames(instance))\n        .filter((name) => !(_.includes(['constructor'], name) || _.startsWith(name, '$')))\n        .uniq()\n        .value()\n        .sort()\n\n      return _.reduce(propNames, (props, propName) => {\n        props[propName] = this[propName]\n        return props\n      }, {})\n    }\n\n    $blank(attrNameOrPath) {\n      return _.blank(this.$get(attrNameOrPath))\n    }\n\n    $enumValue(enumName) {\n      return this.constructor.$enums[enumName].value(this[enumName])\n    }\n\n    $get(attrNameOrPath) {\n      return _.get(this, attrNameOrPath)\n    }\n\n    $has(attrNameOrPath) {\n      // TODO: should it be _.hasIn(), to include inherited properties?\n      // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for its exitence.\n      // It can have side effects!\n      return _.has(this, attrNameOrPath)\n    }\n\n    $pick(...attrNamesOrPathes) {\n      return _.pick(this, ...attrNamesOrPathes)\n    }\n\n    $present(attrNameOrPath) {\n      return _.present(this.$get(attrNameOrPath))\n    }\n\n    $set(attrNameOrPath, value) {\n      return _.set(this, attrNameOrPath, value)\n    }\n  }\n\n  return AttributableClass\n}\n\n\nexport default Attributable\n","import _                      from '@caiena/lodash-ext'\nimport mixin                  from '../mixin'\nimport { defineInternalProp, writablePropNames } from '../meta'\n\n\n\nfunction belongsTo(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(value) {\n      if (value == null) { // null or undefined\n        return this.$relations[relationName] = value\n      }\n\n      if (_.isArray(value)) throw new Error(\"can't assign an array to a belongsTo relation\")\n\n      // TODO: should we assign values to fks? `${relation}_id``\n\n      if (value instanceof ModelClass) {\n        return this.$relations[relationName] = value\n      } else {\n        // construct model instance with value as attributes\n        return this.$relations[relationName] = new ModelClass(value)\n      }\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction hasOne(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(value) {\n      if (value == null) { // null or undefined\n        return this.$relations[relationName] = value\n      }\n\n      if (_.isArray(value)) throw new Error(\"can't assign an array to a hasOne relation\")\n\n      if (value instanceof ModelClass) {\n        return this.$relations[relationName] = value\n      } else {\n        // construct model instance with value as attributes\n        return this.$relations[relationName] = new ModelClass(value)\n      }\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction hasMany(instance, relationName, config, { get = null, set = null } = {}) {\n  if (!get) {\n    get = function get() {\n      return this.$relations[relationName]\n    }\n  }\n\n  if (!set) {\n    // providing a way to lazily evaluate related model class\n    let ModelClass = null\n\n    if (config.model.$$model) { // check if is a model class without circular dependency\n      ModelClass = config.model\n    } else if (typeof config.model === 'string') { // use lookup\n      ModelClass = instance.constructor.$lookupModel(config.model)\n    } else if (typeof config.model === 'function') { // check if is a callable (function)\n      ModelClass = config.model()\n    } else {\n      ModelClass = config.model // default: assign it as a model class\n    }\n\n    set = function set(values) {\n      if (values == null) { // null or undefined\n        return this.$relations[relationName] = []\n      }\n\n      if (!_.isArray(values)) throw new Error(\"can't assign a non-array value to a hasMany relation\")\n\n      // TODO: should we assign values to fks? `${relation}_id`\n\n      let modelInstances = _.map(values, (value) => {\n        return value instanceof ModelClass ? value : new ModelClass(value)\n      })\n\n      return this.$relations[relationName] = modelInstances\n    }\n  }\n\n  Object.defineProperty(instance, relationName, {\n    get,\n    set,\n    configurable: true,\n    enumerable:   true\n  })\n}\n\n\nfunction defineRelation(instance, relationName, config, { get, set } = {}) {\n  switch (config.type) {\n    case 'belongsTo': return belongsTo(...arguments)\n    case 'hasMany':   return hasMany(...arguments)\n    case 'hasOne':    return hasOne(...arguments)\n    default: {\n      throw new Error(`Unknown relation type \"${type}\"`)\n    }\n  }\n}\n\n\n\nfunction Relatable(Class) {\n\n  class RelatableClass extends Class {\n\n    // lazy evaluated $relations\n    static get $relations() {\n      // avoiding static property inheritance\n      // @see http://thecodebarbarian.com/static-properties-in-javascript-with-inheritance.html\n      if (!this.hasOwnProperty('$$relations')) {\n        this.$$relations = this.$$relations || _.reduce(this.relations, (result, config, name) => {\n          result[name] = config\n          return result\n        }, {})\n      }\n\n      return this.$$relations\n    }\n\n\n    constructor(...args) {\n      super(...args)\n\n      let klass = this.constructor\n\n      defineInternalProp(this, '$$relations', {})\n\n      // defining relations get/set properties\n      _.each(klass.relations, (config, relationName) => {\n        // XXX: lodash _.has and _.hasIn actually _execute_ the method/property to check for\n        // existence. We don't want that!\n        if (!this.hasOwnProperty(relationName)) {\n          // first, check if it is defined in prototype\n          if (this.constructor.prototype.hasOwnProperty(relationName)) {\n            let _proto = Object.getPrototypeOf(this)\n            let _descr = Object.getOwnPropertyDescriptor(_proto, relationName)\n            defineRelation(this, relationName, config, { get: _descr.get, set: _descr.set })\n          } else {\n            defineRelation(this, relationName, config)\n          }\n        }\n      })\n    }\n\n    get $relations() {\n      // XXX: $relations and $$relations will be confusing...\n      return this.$$relations\n    }\n  }\n\n  return RelatableClass\n}\n\n\nexport default Relatable\n","import _        from '@caiena/lodash-ext'\nimport { i18n } from '@caiena/i18n'\n\n\nfunction Translatable(Class) {\n  class TranslatableClass extends Class {\n    static get i18nScope() {\n      return `models.${this.$modelName}`\n    }\n\n    static $tModelName({ count = 1 } = {}) {\n      return i18n.t(this.i18nScope, { count })\n    }\n\n    static $tAttr(attrName, options = {}) {\n      let scope = `${this.i18nScope}.attributes`\n      return i18n.t(attrName, _.defaults({}, options, { scope }))\n    }\n\n    static $tEnum(enumName, enumValue = undefined, options = {}) {\n      let scope = this.i18nScope\n      let key = null\n\n      if (enumValue === undefined) {\n        // .attributes.${enumName}\n        scope += '.attributes'\n        key = enumName\n      } else {\n        // .enums.${enumName}.${enumValue}\n        scope += `.enums.${enumName}`\n        key = enumValue\n      }\n\n      return i18n.t(key, _.defaults({}, options, { scope }))\n    }\n\n    // TODO: localize attribute\n    // $l(attrName) {\n    //  // checkout type definition for date or datetime\n    //  // use $l('date', attrName)\n    //  // or  $l('time', attrName)\n    // }\n  }\n\n  return TranslatableClass\n}\n\n\nexport default Translatable\n","// @see https://validatejs.org/#validators-datetime\n// We're addming moment\n\nimport validate from 'validate.js'\nimport _        from '@caiena/lodash-ext'\nimport moment   from 'moment'\n\n\n// Before using it we must add the parse and format functions\n// Here is a sample implementation using moment.js\nvalidate.extend(validate.validators.datetime, {\n  // The value is guaranteed not to be null or undefined but otherwise it\n  // could be anything.\n  parse(value, options) {\n    // return +moment.utc(value)\n    return moment.utc(value)\n  },\n  // Input is a unix timestamp\n  format(value, options) {\n    var format = options.dateOnly ? 'YYYY-MM-DD' : 'YYYY-MM-DD hh:mm:ss'\n    return moment.utc(value).format(format)\n  }\n})\n\n\nexport default validate.validators.datetime\n","import validate from 'validate.js'\nimport _        from '@caiena/lodash-ext'\n\n// XXX overwriting presence validator.\n//\nfunction presence(value, options, key, attrs) {\n  let opts = _.merge({}, this.options, options)\n\n  if (_.blank(value)) {\n    return opts.message || this.message || \"can't be blank\";\n  }\n\n  // returning nothing means \"is valid\"\n}\n\nvalidate.validators.presence = presence\n\nexport default presence\n","// register all custom validators\nimport './datetime'\nimport './presence'\n\n\nexport default {}\n","import _        from '@caiena/lodash-ext'\nimport { i18n } from '@caiena/i18n'\nimport { defineInternalProp } from '../meta'\nimport validate from 'validate.js'\nimport '../validators/register'\n\n\n// custom error formatter, creating a code/values interpolation scheme with i18n\n// @see http://validatejs.org/#validate-error-formatting\nfunction transformErrors(i18nScope, errors) {\n  // errors sample:\n  // // => [\n  //   {\n  //     \"attribute\": \"username\",\n  //     \"value\": \"nicklas\",\n  //     \"validator\": \"exclusion\",\n  //     \"globalOptions\": {\n  //       \"format\": \"detailed\"\n  //     },\n  //     \"attributes\": {\n  //       \"username\": \"nicklas\",\n  //       \"password\": \"bad\"\n  //     },\n  //     \"options\": {\n  //       \"within\": [\n  //         \"nicklas\"\n  //       ],\n  //       \"message\": \"'%{value}' is not allowed\"\n  //     },\n  //     \"error\": \"Username 'nicklas' is not allowed\"\n  //   },\n  //   {\n  //     \"attribute\": \"password\",\n  //     \"value\": \"bad\",\n  //     \"validator\": \"length\",\n  //     \"globalOptions\": {\n  //       \"format\": \"detailed\"\n  //     },\n  //     \"attributes\": {\n  //       \"username\": \"nicklas\",\n  //       \"password\": \"bad\"\n  //     },\n  //     \"options\": {\n  //       \"minimum\": 6,\n  //       \"message\": \"must be at least 6 characters\"\n  //     },\n  //     \"error\": \"Password must be at least 6 characters\"\n  //   }\n  // ]\n  errors = validate.groupErrorsByAttribute(errors)\n  let transformedErrors = {}\n\n  for (let attr in errors) {\n    transformedErrors[attr] = []\n\n    for (let error of errors[attr]) {\n      let code = error.validator\n      let message = _.get(error, 'options.message') ||\n        i18n.t(`errors.${code}`, {\n          scope: i18nScope,\n          defaultValue: i18n.t(`errors.${code}`),\n          value: error.value\n        })\n\n      transformedErrors[attr].push({\n        attribute: error.attribute,\n        value: error.value,\n        code,\n        message\n      })\n    }\n  }\n\n  return transformedErrors\n}\n\n\nfunction Validatable(Class) {\n\n  class ValidatableClass extends Class {\n\n    constructor(...args) {\n      super(...args)\n      defineInternalProp(this, '$$errors', {})\n    }\n\n    get $errors() {\n      return this.$$errors\n    }\n\n    async $validate() {\n      let constraints = this.constructor.constraints\n      let instance = this\n\n      // adapting api to .then(success, error) to .then(success).catch(error)\n      return new Promise((resolve, reject) => {\n        // - cleanAttributes: false - to tell validatejs not to delete empty or without constraint attributes\n        // @see https://validatejs.org/#validate-async\n        //   > Besides accepting all options as the non async validation function it also accepts\n        //   > two additional options; cleanAttributes which, unless false, makes validate.async\n        //   > call validate.cleanAttributes before resolving the promise (...)\n        // @see https://validatejs.org/#utilities-clean-attributes\n        validate.async(this, constraints, { format: 'detailed', cleanAttributes: false })\n          .then(\n            function success(attributes) {\n              // reset errors\n              instance.$$errors = {}\n              resolve(true)\n            },\n\n            function error(errors) {\n              if (errors instanceof Error) {\n                // runtime Error. Just throw it\n                // reset errors\n                instance.$$errors = {}\n                reject(errors)\n              } else {\n                // validation error.\n                // assign to $errors\n                instance.$$errors = transformErrors(instance.constructor.i18nScope, errors)\n                resolve(false)\n              }\n            })\n      })\n    }\n  }\n\n  return ValidatableClass\n}\n\n\nexport default Validatable\n","import _                     from '@caiena/lodash-ext'\nimport { writablePropNames } from './meta'\nimport mixin                 from './mixin'\nimport Attributable          from './mixins/attributable'\nimport Relatable             from './mixins/relatable'\nimport Translatable          from './mixins/translatable'\nimport Validatable           from './mixins/validatable'\n\n\nclass Base {\n  static get $modelNameAdapter() { return _.camelize }\n  static get $modelName()        { return this.$modelNameAdapter(this.name) }\n\n  static get attrs()     { return [] }\n  static get enums()     { return {} }\n  static get virtuals()  { return [] }\n\n  static $lookupModel(name) {\n    throw new Error('Model.$lookupModel(name) is not implemented.')\n  }\n}\n\nclass Model extends mixin(Base, [Attributable, Relatable, Translatable, Validatable]) {\n  static get $$model() { return true } // allow programmatically checking if it's a model class\n\n  // using \"props\" as name to make it explicit that we'll set any enumerable \"property\" in the instance\n  // (JavaScript land - getOwnPropertyDescriptor() and prototype)\n  constructor(props = {}, { undefs = true } = {}) {\n    super()\n\n    this.$beforeInit(...arguments) // hook for user land\n\n    let propNames = writablePropNames(this)\n    let sanitizedProps = _.pick(props, propNames)\n\n    if (undefs) {\n      // start all props with undefined, allowing them to be observed (rxjs, Vue, ...)\n      let undefProps = _.reduce(propNames, (undefProps, name) => {\n        undefProps[name] = undefined\n        return undefProps\n      }, {})\n\n      // adding undefs if not defined yet\n      // _.defaults(sanitizedProps, undefProps)\n      // XXX: using _.merge() here to keep properties names sorted\n      sanitizedProps = _.merge(undefProps, sanitizedProps)\n    }\n\n    // set props, one-by-one, using setter method\n    _.each(sanitizedProps, (value, name) => {\n      this[name] = value\n    })\n\n    this.$afterInit(...arguments) // hook for user land\n  }\n\n  $beforeInit(...args) {\n    // override it in subclasses\n  }\n\n  $afterInit(...args) {\n    // override it in subclasses\n  }\n\n  toJSON({ pick = [], include = [], omit = [], virtuals = false, relations = false, undefs = false } = {}) {\n    let json = _.clone(this.$attrs)\n\n    if (!undefs) {\n      json = _.pickBy(json, (val, key) => !_.isUndefined(val))\n    }\n\n    if (virtuals) {\n      _.merge(json, _.pick(this, this.constructor.virtuals))\n    }\n\n    if (relations) { // TODO: test it\n      _.merge(json, _.pick(this, this.constructor.$relations))\n    }\n\n    if (_.present(pick)) {\n      json = _.pick(json, pick)\n    }\n\n    if (_.present(include)) {  // TODO: test it\n      json = _.merge(json, _.pick(this, include))\n    }\n\n    if (_.present(omit)) {\n      json = _.omit(json, omit)\n    }\n\n    return json\n  }\n\n  $serialize(...args) {\n    return this.toJSON(...args)\n  }\n}\n\n\nexport default Model\n","import _ from '@caiena/lodash-ext'\nimport Model from '../model'\n\n\nfunction Decorator(ModelClass) {\n\n  class DecoratedClass extends ModelClass {\n    static get $modelClass() { return ModelClass }\n\n    constructor(object) {\n      let _object = (object instanceof Model) ? object : new ModelClass(object)\n\n      // sanity check\n      if (_object.hasOwnProperty('$object')) {\n        throw new Error('Decorated object cannot have a property named \"$object\"')\n      }\n\n      super({ $object: _object, ..._object.$props })\n    }\n\n    // hook to define $object before constructing the model instance\n    $beforeInit(props, opts) {\n      this.$object = props.$object\n\n      super.$beforeInit(props, opts)\n    }\n  }\n\n  return DecoratedClass\n}\n\n\nexport default Decorator\n","import _ from '@caiena/lodash-ext'\nimport * as contents from './*.yml'\n\nconst translations = {}\n\n_.each(contents, (content, _id) => {\n  _.merge(translations, content)\n})\n\n\nexport default translations\n"],"names":["defineInternalProp","obj","prop","value","Object","defineProperty","enumerable","writable","configurable","writableProp","instance","name","_","includes","startsWith","descriptor","hasOwnProperty","getOwnPropertyDescriptor","prototype","getPrototypeOf","set","writablePropNames","propNames","chain","getOwnPropertyNames","concat","uniq","sort","filter","mixin","Class","mixins","reduce","MixedClass","Mixin","defineAttr","attrName","get","$attrs","defineEnum","enumName","key","constructor","$enums","Attributable","AttributableClass","$$enums","enums","result","enumeration","Enum","$$attrs","clone","attrs","$$virtuals","virtuals","$$constraints","constraints","args","klass","each","Error","_proto","_descr","attrNameOrPath","blank","$get","has","attrNamesOrPathes","pick","present","sanitizedAttrs","proto","props","propName","belongsTo","relationName","config","$relations","ModelClass","model","$$model","$lookupModel","isArray","hasOne","hasMany","values","modelInstances","map","defineRelation","type","arguments","Relatable","RelatableClass","$$relations","relations","Translatable","TranslatableClass","count","i18n","t","i18nScope","options","scope","defaults","enumValue","undefined","$modelName","validate","extend","validators","datetime","parse","moment","utc","format","dateOnly","presence","opts","merge","message","transformErrors","errors","groupErrorsByAttribute","transformedErrors","attr","error","code","validator","defaultValue","push","attribute","Validatable","ValidatableClass","Promise","resolve","reject","async","cleanAttributes","then","success","attributes","$$errors","Base","camelize","$modelNameAdapter","Model","undefs","$beforeInit","sanitizedProps","undefProps","$afterInit","include","omit","json","pickBy","val","isUndefined","toJSON","Decorator","DecoratedClass","object","_object","$object","$props","translations","contents","content","_id"],"mappings":"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"}